if(!customElements.get("m-product-inventory")){class t extends HTMLElement{constructor(){super(),this.selectors={inventoryQuantity:".m-product-inventory__quantity",inventoryStatus:".m-product-inventory__status",inventoryMessage:".m-product-inventory__message",indicatorBar:".m-product-inventory__indicator-bar"},this.domNodes=queryDomNodes(this.selectors,this)}connectedCallback(){this.productId=this.dataset.productId,this.inventoryVisibility=this.dataset.inventoryVisibility,this.hideStockBackordered="true"===this.dataset.hideStockBackordered,this.handleVariantChange(),this.updateInventoryStatus(parseInt(this.dataset.inventoryQuantity),"true"===this.dataset.variantAvailable,this.dataset.inventoryPolicy)}handleVariantChange(){window.MinimogEvents.subscribe(`${this.productId}__VARIANT_CHANGE`,(t=>{if(t){const e=JSON.parse(this.querySelector('[type="application/json"]').textContent).filter((e=>e.id===t.id))[0];this.updateInventoryStatus(parseInt(e.inventory_quantity),e.available,e.inventory_policy)}else this.updateInventoryStatus(0,!1)}))}updateInventoryStatus(t,e,s){let o,i=!1;if(o=t<=0?"continue"===s?"backordered":e?"instock":"outofstock":t<=this.dataset.inventoryThreshold?"low":"normal",this.setAttribute("data-status",o),"always"==this.inventoryVisibility?(i=!0,"backordered"==o&&this.hideStockBackordered&&(i=!1)):"low"==o&&(i=!0),i){if(this.classList.remove("m:hidden"),this.domNodes.inventoryMessage.innerHTML=this.getInventoryText()[o].message,this.getInventoryText()[o].show_count)if(this.getInventoryText()[o].text_html){let e=this.getInventoryText()[o].text_html.replace("{{ quantity }}",t);this.domNodes.inventoryStatus.classList.remove("m:hidden"),this.domNodes.inventoryStatus.innerHTML=e}else this.domNodes.inventoryStatus.innerHTML="",this.domNodes.inventoryStatus.classList.add("m:hidden");else this.getInventoryText()[o].text?(this.domNodes.inventoryStatus.classList.remove("m:hidden"),this.domNodes.inventoryStatus.innerHTML=this.getInventoryText()[o].text):(this.domNodes.inventoryStatus.innerHTML="",this.domNodes.inventoryStatus.classList.add("m:hidden"));this.handleIndicatorBar(o,t)}else this.classList.add("m:hidden")}handleIndicatorBar(t,e){if(this.domNodes.indicatorBar){const s=this.dataset.total;let o;"backordered"==t||"outofstock"==t?o=0:"backordered"!=t&&(e>=s||"instock"==t)?o=100:(o=(e/s*100).toFixed(1),o=o<5?5:o),this.domNodes.indicatorBar.querySelector("span").style.width=`${o}%`}}getInventoryText(){const{inStock:t,outOfStock:e,lowStock:s,inventoryQuantityHtml:o,inventoryLowQuantityHtml:i}=window.MinimogStrings,n=this.dataset.showInventoryCount;return{normal:{text:t,text_html:o,message:this.dataset.normalText,show_count:"always"==n},instock:{text:t,message:this.dataset.normalText,show_count:!1},low:{text:s,text_html:i,message:this.dataset.lowText,show_count:"never"!=n},outofstock:{text:e,message:this.dataset.outofstockText,show_count:!1},backordered:{text:"",message:this.dataset.backorderedText,show_count:!1}}}}customElements.define("m-product-inventory",t)}